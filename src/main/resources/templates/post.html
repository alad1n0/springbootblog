<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FOOD.CO.UK</title>

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/vendor.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/fonts.css">

    <!-- favicons
    ================================================== -->
    <link rel="icon" href="/images/food-2.svg" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- script
    ================================================== -->
    <script src="/js/plugins.js"></script>
    <script src="/js/modernizr.js"></script>
    <script src="/js/pace.min.js"></script>
</head>
<body>
    <div class="s-pageheader">
        <header class="header">
            <div class="header__content row">
                <div class="header__logo">
                    <a class="logo" th:href="@{/}">
                        <img src="/images/food.svg" alt="Homepage">
                    </a>
                </div>
                <ul class="header__social">
                    <li>
                        <a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-pinterest" aria-hidden="true"></i></a>
                    </li>
                </ul>

                <div class="header__login-wrapper" sec:authorize="!isAuthenticated()">
                    <a th:href="@{/login}" class="header__users-login">Login</a>
                    <a th:href="@{/register}" class="header__users-register">Register</a>
                </div>

                <div class="header__account">
                    <div class="header__user-menu" sec:authorize="isAuthenticated()">
                        <div class="header__users">
                            <svg xmlns="http://www.w3.org/2000/svg" style="margin-top: -5px" width="23" height="23" viewBox="0 0 40 40" fill="none">
                                <g clip-path="url(#clip0_2933_10946)">
                                    <path d="M20 20C21.9778 20 23.9112 19.4135 25.5557 18.3147C27.2002 17.2159 28.4819 15.6541 29.2388 13.8268C29.9957 11.9996 30.1937 9.98891 29.8079 8.0491C29.422 6.10929 28.4696 4.32746 27.0711 2.92894C25.6725 1.53041 23.8907 0.578004 21.9509 0.192152C20.0111 -0.193701 18.0004 0.00433286 16.1732 0.761209C14.3459 1.51809 12.7841 2.79981 11.6853 4.4443C10.5865 6.08879 10 8.02219 10 10C10.0026 12.6514 11.0571 15.1934 12.9319 17.0682C14.8066 18.9429 17.3486 19.9974 20 20ZM20 3.33334C21.3185 3.33334 22.6075 3.72433 23.7038 4.45687C24.8001 5.18942 25.6546 6.23061 26.1592 7.44878C26.6638 8.66696 26.7958 10.0074 26.5386 11.3006C26.2813 12.5938 25.6464 13.7817 24.714 14.7141C23.7817 15.6464 22.5938 16.2813 21.3006 16.5386C20.0074 16.7958 18.667 16.6638 17.4488 16.1592C16.2306 15.6546 15.1894 14.8001 14.4569 13.7038C13.7243 12.6075 13.3333 11.3185 13.3333 10C13.3333 8.2319 14.0357 6.5362 15.286 5.28596C16.5362 4.03572 18.2319 3.33334 20 3.33334ZM20 23.3333C16.0231 23.3378 12.2104 24.9195 9.39827 27.7316C6.58618 30.5437 5.00441 34.3564 5 38.3333C5 38.7754 5.17559 39.1993 5.48816 39.5119C5.80072 39.8244 6.22464 40 6.66667 40C7.10869 40 7.53262 39.8244 7.84518 39.5119C8.15774 39.1993 8.33333 38.7754 8.33333 38.3333C8.33333 35.2391 9.5625 32.2717 11.7504 30.0838C13.9383 27.8958 16.9058 26.6667 20 26.6667C23.0942 26.6667 26.0617 27.8958 28.2496 30.0838C30.4375 32.2717 31.6667 35.2391 31.6667 38.3333C31.6667 38.7754 31.8423 39.1993 32.1548 39.5119C32.4674 39.8244 32.8913 40 33.3333 40C33.7754 40 34.1993 39.8244 34.5118 39.5119C34.8244 39.1993 35 38.7754 35 38.3333C34.9956 34.3564 33.4138 30.5437 30.6017 27.7316C27.7896 24.9195 23.9769 23.3378 20 23.3333Z" fill="white"/>
                                </g>
                                <defs>
                                    <clipPath id="clip0_2933_10946">
                                        <rect width="40" height="40" fill="white"/>
                                    </clipPath>
                                </defs>
                            </svg>
                            <p class="header_user_name">My profile</p>
                            <svg class="profile__icon" xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 40 40" fill="none">
                                <path d="M32.1365 13.5423C31.966 13.3705 31.7633 13.2341 31.5398 13.141C31.3164 13.0479 31.0768 13 30.8348 13C30.5928 13 30.3531 13.0479 30.1297 13.141C29.9063 13.2341 29.7036 13.3705 29.5331 13.5423L21.1365 21.939C20.966 22.1108 20.7633 22.2472 20.5398 22.3403C20.3164 22.4333 20.0768 22.4813 19.8348 22.4813C19.5928 22.4813 19.3531 22.4333 19.1297 22.3403C18.9063 22.2472 18.7036 22.1108 18.5331 21.939L10.1365 13.5423C9.96602 13.3705 9.76325 13.2341 9.53984 13.141C9.31644 13.0479 9.07681 13 8.83479 13C8.59276 13 8.35314 13.0479 8.12973 13.141C7.90632 13.2341 7.70355 13.3705 7.53312 13.5423C7.19166 13.8858 7 14.3505 7 14.8348C7 15.3191 7.19166 15.7838 7.53312 16.1273L15.9481 24.5423C16.9794 25.5723 18.3773 26.1508 19.8348 26.1508C21.2923 26.1508 22.6902 25.5723 23.7215 24.5423L32.1365 16.1273C32.4779 15.7838 32.6696 15.3191 32.6696 14.8348C32.6696 14.3505 32.4779 13.8858 32.1365 13.5423Z" fill="white"/>
                            </svg>
                        </div>
                        <div class="dropdown-content">
                            <a href="/profile">Profile</a>
                            <a th:href="@{/logout}">Logout</a>
                        </div>
                    </div>
                    <a class="header__search-trigger" href="#"></a>
                </div>

                <a class="header__toggle-menu" href="#" title="Menu"><span>Menu</span></a>

                <nav class="header__nav-wrap">

                    <h2 class="header__nav-heading h6">Site Navigation</h2>

                    <ul class="header__nav">
                        <li><a th:href="@{/}" title="">Home</a></li>
                        <li><a th:href="@{/posts}" title="">Posts</a></li>
                        <li class="has-children">
                            <a href="#" title="">Topics</a>
                            <ul class="sub-menu">
                                <li th:each="category : ${categories}">
                                    <a th:href="@{'/posts/by-category/' + ${category.id}}" th:text="${category.title}"></a>
                                </li>
                            </ul>
                        </li>
                        <li><a th:href="@{/aboute}" title="">About</a></li>
                        <li><a th:href="@{/contact}" title="">Contact</a></li>
                        <li sec:authorize="!isAuthenticated()" class="li_login"><a th:href="@{/login}" title="">Login</a></li>
                        <li sec:authorize="!isAuthenticated()" class="li_tegister"><a th:href="@{/register}" title="">Register</a></li>
                        <li class="header__search-trigger"></li>
                    </ul>

                    <a href="#" title="Close Menu" class="header__overlay-close close-mobile-menu">Close</a>
                </nav>

                <div class="header__search">
                    <form role="search" method="get" class="header__search-form" action="#">
                        <label>
                            <input type="search" class="search-field" placeholder="Type Keywords" value="" name="s" title="Search for:" autocomplete="off">
                        </label>
                        <input type="submit" class="search-submit" value="Search">
                    </form>
                    <a href="#" title="Close Search" class="header__overlay-close">Close</a>
                </div>
            </div>
        </header>
    </div>

    <section class="s-content s-content--narrow s-content--no-padding-bottom">
        <article class="row format-standard">
            <div class="s-content__header col-full">
                <h1 style="padding: 0 8rem;" class="s-content__header-title" th:text="${post.title}"></h1>
                <ul class="s-content__header-meta">
                    <li class="date">
                        <span th:text="${post.formattedDate}"></span>
                        <a style="padding-left: 10px;" th:href="@{'/posts/by-category/' + ${postCategory.id}}" th:text="${'In ' + postCategory.title}"></a>
                    </li>
                    <li class="post_options" sec:authorize="isAuthenticated()" th:if="${#authentication.principal.username == post.account.email}">
                        <div class="btn-edit">
                            <a th:href="@{'/posts/' + ${post.id} + '/edit'}">EDIT</a>
                            <svg xmlns="http://www.w3.org/2000/svg" width="21" height="20" viewBox="0 0 21 20" fill="none">
                                <path d="M2.99902 14.375V17.5H6.12402L15.3407 8.28333L12.2157 5.15833L2.99902 14.375ZM5.43236 15.8333H4.66569V15.0667L12.2157 7.51667L12.9824 8.28333L5.43236 15.8333ZM17.7574 4.69167L15.8074 2.74167C15.6407 2.575 15.4324 2.5 15.2157 2.5C14.999 2.5 14.7907 2.58333 14.6324 2.74167L13.1074 4.26667L16.2324 7.39167L17.7574 5.86667C18.0824 5.54167 18.0824 5.01667 17.7574 4.69167Z" fill="#29322F"/>
                            </svg>
                        </div>
                        <div class="btn-delete">
                            <a th:href="@{'/posts/' + ${post.id} + '/delete'}" onclick="return confirm('Are you sure you want to delete this post?');">DELETE</a>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M12.9165 3.33333L12.0832 2.5H7.9165L7.08317 3.33333H4.1665V5H15.8332V3.33333H12.9165ZM4.99984 15.8333C4.99984 16.75 5.74984 17.5 6.6665 17.5H13.3332C14.2498 17.5 14.9998 16.75 14.9998 15.8333V5.83333H4.99984V15.8333ZM6.6665 11.6667V7.5H13.3332V15.8333H6.6665V11.6667Z" fill="#AA0000"/>
                            </svg>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="s-content__media col-full">
                <div class="s-content__post-thumb">
                    <img th:if="${post.imageBase64}" th:src="'data:image/jpeg;base64,' + ${post.imageBase64}" alt="" >
                </div>
            </div>

            <div class="col-full s-content__main">
                <p class="lead" th:text="${post.body}"></p>

                <p class="s-content__tags">
                    <span>Post Tags</span>

                    <span class="s-content__tag-list">
                        <a href="#">orci</a>
                        <a href="#">lectus</a>
                        <a href="#">varius</a>
                        <a href="#">turpis</a>
                    </span>
                </p>

                <div class="s-content__pagenav">
                    <div class="s-content__nav">
                        <div class="col-full">
                            <nav class="pgn">
                                <ul style="display: flex; justify-content: space-between;">
                                    <li>
                                        <a class="pgn__prev" th:href="${previousPostUrl}" th:classappend="${previousPostUrl == null ? 'disabled' : ''}"></a>
                                    </li>
                                    <li>
                                        <a class="pgn__next" th:href="${nextPostUrl}" th:classappend="${nextPostUrl == null ? 'disabled' : ''}"></a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </article>

        <div class="comments-wrap">
            <div id="comments" class="row">
                <div id="commentsContainer" class="col-full">
                    <h3 id="commentsHeading" th:if="${not #lists.isEmpty(comments)}" class="h2">Comments</h3>
                    <ol class="commentlist" id="commentList">
                        <li class="depth-1 comment" th:each="comment : ${comments}">
                            <div class="comment__avatar">
                                <img style="width: 50px; height: 50px;" class="avatar" src="/images/avatars/user-01.jpg" alt="">
                            </div>
                            <div class="comment__content">
                                <div class="comment__info">
                                    <cite th:text="${comment.account.firstName}"></cite>
                                </div>
                                <div class="comment__meta">
                                    <time class="comment__time" th:text="${comment.formattedDate}"></time>
                                </div>
                                <div class="comment__text">
                                    <p th:text="${comment.text}"></p>
                                </div>
                            </div>
                        </li>
                    </ol>
                </div>

                <div class="respond">
                    <h3 class="h2">Add Comment</h3>
                    <form id="commentForm" th:action="@{/posts/{postId}/comments(postId=${post.id})}" method="post">
                        <fieldset>
                            <div class="message form-field">
                                <label for="text"></label><textarea name="text" id="text" class="full-width" placeholder="Your Message"></textarea>
                            </div>
                            <button type="submit" class="submit btn--primary btn--large full-width">Submit</button>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <footer class="s-footer">
        <div class="s-footer__main">
            <div class="row">
                <div class="col-two md-four mob-full s-footer__sitelinks">
                    <h4>Quick Links</h4>
                    <ul class="s-footer__linklist">
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Posts</a></li>
                        <li><a href="#">About</a></li>
                        <li><a href="#">Contact</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>

                <div class="col-two md-four mob-full s-footer__archives">
                    <h4>Topics</h4>
                    <ul class="s-footer__linklist">
                        <li th:each="category : ${categories}">
                            <a th:href="@{'/posts/by-category/' + ${category.id}}" th:text="${category.title}"></a>
                        </li>
                    </ul>
                </div>

                <div class="col-two md-four mob-full s-footer__social">
                    <h4>Social</h4>
                    <ul class="s-footer__linklist">
                        <li><a href="#">Facebook</a></li>
                        <li><a href="#">Instagram</a></li>
                        <li><a href="#">Twitter</a></li>
                        <li><a href="#">Pinterest</a></li>
                        <li><a href="#">Google+</a></li>
                        <li><a href="#">LinkedIn</a></li>
                    </ul>
                </div>

                <div class="col-five md-full end s-footer__subscribe">
                    <h4>Our Newsletter</h4>
                    <p>
                        Join our community of food lovers and get the best of our culinary blog delivered straight to you. Whether you’re looking for new meal ideas or just want to keep in touch with the latest trends, our newsletter is the perfect way to stay connected.
                    </p>
                    <div class="subscribe-form">
                        <form id="mc-form" class="group" novalidate="novalidate">
                            <input type="email" value="" name="EMAIL" class="email" id="mc-email" placeholder="Email Address" required="">
                            <input type="submit" name="subscribe" value="Send">
                            <label for="mc-email" class="subscribe-message"></label>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="s-footer__bottom">
            <div class="row">
                <div class="col-full">
                    <div class="s-footer__copyright">
                        <span>© Copyright FOOD.CO.UA 2024</span>
                        <span>Site Template by <a href="#">alad1n0</a></span>
                    </div>

                    <div class="go-top">
                        <a style="padding-right: 15px;" th:href="@{/posts/new}">Create post
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 40 40" fill="none">
                                <path d="M22.4583 18.0417V7H18.0417V18.0417H7V22.4583H18.0417V33.5H22.4583V22.4583H33.5V18.0417H22.4583Z" fill="white"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>

    </footer>

    <div id="preloader">
        <div id="loader">
            <div class="line-scale">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('commentForm');

            form.addEventListener('submit', function (event) {
                event.preventDefault();

                const formData = new FormData(form);

                fetch(form.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'Accept': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const commentsList = document.querySelector('.commentlist');
                            const commentsContainer = document.getElementById('commentsContainer');

                            if (!document.getElementById('commentsHeading')) {
                                const heading = document.createElement('h3');
                                heading.id = 'commentsHeading';
                                heading.className = 'h2';
                                heading.textContent = 'Comments';

                                if (commentsContainer) {
                                    commentsContainer.insertBefore(heading, commentsList);
                                } else {
                                    document.body.insertBefore(heading, commentsList);
                                }
                            }

                            const newCommentHtml = `
                                <li class="depth-1 comment">
                                    <div class="comment__avatar">
                                        <img style="width: 50px; height: 50px;" class="avatar" src="/images/avatars/user-01.jpg" alt="">
                                    </div>
                                    <div class="comment__content">
                                        <div class="comment__info">
                                            <cite>${data.comment.accountFirstName}</cite>
                                        </div>
                                        <div class="comment__meta">
                                            <time class="comment__time">${data.comment.formattedDate}</time>
                                        </div>
                                        <div class="comment__text">
                                            <p>${data.comment.text}</p>
                                        </div>
                                    </div>
                                </li>
                            `;

                            if (commentsList) {
                                commentsList.insertAdjacentHTML('afterbegin', newCommentHtml);
                                if (commentsHeading) {
                                    commentsHeading.style.display = 'block';
                                }
                            } else {
                                console.error('Comments list not found.');
                            }

                            form.reset();
                        } else {
                            alert(data.message || 'Failed to add comment');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            });
        });
    </script>
    <script src="/js/jquery-3.2.1.min.js"></script>
    <script src="/js/plugins.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>